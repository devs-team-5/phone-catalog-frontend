import{s as o,u as d,a as l}from"./index-B2MS1XWL.js";const g=async s=>{if(!s?.id)return;const u=()=>d.getState().cart,f=()=>l.getState().favourites,v=a=>d.getState().syncWithServer(a),m=a=>l.getState().syncWithServer(a),n=window.location.search.includes("payment=success")||window.location.hash.includes("payment=success");try{let a=null;if(!n){const{data:t}=await o.from("cart_items").select("item_id, count").eq("user_id",s.id);a=t}const{data:h}=await o.from("favorites").select("item_id").eq("user_id",s.id),_=u(),w=f();if(!n){const t=new Map;a?.forEach(e=>{t.set(e.item_id,{itemId:e.item_id,count:e.count})});const i=[];_.forEach(e=>{t.has(e.itemId)||(t.set(e.itemId,e),i.push({user_id:s.id,item_id:e.itemId,count:e.count}))}),i.length>0&&await o.from("cart_items").insert(i),v(Array.from(t.values()))}const r=new Set;h?.forEach(t=>r.add(t.item_id));const c=[];w.forEach(t=>{r.has(t)||(r.add(t),c.push({user_id:s.id,item_id:t}))}),c.length>0&&await o.from("favorites").insert(c),m(Array.from(r.values()))}catch(a){console.error("Failed to sync data with server:",a)}};export{g as syncCartAndFavourites};
